#Grabbing RT sequence:
#paper: https://www.biorxiv.org/content/10.1101/429613v1.full
#website: http://bit.ly/repbrowser (load into ucsc track)

#full_int:
#>hub_1953865_repeats2_hub_1953865_repNames_HERVH-int range=HERVH-int:1-3825 5'pad=0 3'pad=0 strand=+ repeatMasking=none
#TTTGGTGCCGTGACTCGGATCGGGGGACCTCCCTTGGGAGATCAATCCCCTGTCCTCCTGCTCTTTGCTCCGTGAGAAAGATCCACCTACGACCTCAGGTCCTCAGACCGACCAGCCCAAGAAACATCTCACCAATTTTAAATCCGGTAAGCGGCCTCTTTTTACTCTCTTCTCCAACCTCCCTCACTATCCCTCAACCTCTTTCTCCTTTCAATCTTGGCGCCACACTTCAATCTCTCCCTTCTCTTAATTTCAATTCCTTTCATTTTCTGGTAGAGACAAAGGAGACACGTTTTATCCGTGGACCCAAAACTCCGGCGCCGGTCACGGACTGGGAAGGCAGCCTTCCCTTGGTGTTTAATCATTGCAGGGACGCCTCTCTGATTATTCACCCACGTTTCAGAGGTGTCAGACCACGCAGGGACGCCTGCCTTGGTCCTTCACCCTTAGCGGCAAGTCCCGCTTTTCTGGGGNAGGGGCAAGTACCCCAACCCCTTCTCTCCGTGTCTCTACCCCTTCTCTGCTTTTCTGGGGGCAAGAACCCCTCAACCCCTTCTCCTTCACCCTTAGGGCAAGTCCCCTTTTCTAGGGGGCAAGAACCCCCTATCTCTGTGCCCCATCCCTTATTTCCCCCCAACCCCTTATTTCCGTGCCCCATCCCTTATTTCCATGCCCCGACCTCTTATCTCTGTGCCCCANCCCTTATTTCCATGCCCCGACCCCTTTTCCGCTTTTCTGGAGGGTAAGAACCCCCCAACCCCTTCCCTCCGTGTCTCTACCTCTCTTTTCTCTGGGCTTGCCTCCTTCACTATGGGCAACCTTCCACCCTCCATTCCTCCTTCTTCTCCCTTAGCCTGTGTTCTCAAGAACTTAAAACCTCTTCAACTCACACCTGACCTAAAACCTAAATGCCTTATTTTCTTCTGCAATGCCGCTTGACCCCAATACAAACTCGACAGTAGTTCCAAATAGCCAGAAAACGGCACTTTCAATTTTTCCATCCTACAAGATCTAAATAATTCTTGTCGTAAAATNGGCAAATGGTCTGAGGTGCCTGACGTCCAGGCATTCTTTTACACATCAGTCCCTCCCTAGTCTCTGTTCCCAATGCAACTCNTCCCAAATCTTCCTTCTTTCCCTCCCGCCTGTCCCCTCAGTCCCAACCCCAAGCGTCGCTGAGTCTTTCTAATCTTCCTTTTCTACAGACCCATCTGACCTCTCCCCTCCTCGCCAGGCCGAGCTAGGTCCCAATTCTTCCTCAGCCTCTGCTCCTCCACCCTATAATCCTTTTATCACCTCCCCTCCTCACACCTGGTCCGGCTTACAGTTTCGTTCCGTGACTAGCCCTCCCCCACCTGCCCAGCAATTTACTCTTAAAAAGGTGGCTGGAGCTAAAGGCATAGTCAAGGTTAATGCTCCTTTTTCTTTATCCCAAATCAGATAGCGTTTAGGCTCTTTTTCATCAAATATAAAAACCCAGCCCAGTTCATGGCTCGTTTGGCAGCAACCCTGAGACGCTTTACAGCCCTAGACCCTAAAAGGTCAAAAGGCCGTCTTATTCTCAATATACATTTTATTACCCAATCTGCTCCCGACATTAAATAAAACTCCAAAAATTAAATTCCGGCCCTCAAACCCCACAACAGGACTTAATTAACCTCGCCTTCAAGGTGTACAATAATAGAGTAGAGGCAGCCAAGTAGCAACATATTTCTGAGTTGCAATTCCTTGCCTCCACTGTGAGACAAACCCCAGCCACATCTCCAGCACACAAGAACTTCCAAACGCCTAAACCGCAGTGGCCAGGCATTCCTCCAGAACCTCCTCCCCCAGGAGCTTGCTACAAGTGCCAGAAATCTGGCCACNAGGCCAAGGAATGCCCGCAGCCCAGGATTCCTCCTAAGCCGTGTCCCATCTGTGCGGGACCCCACTGGAAATCGGACTGTTCAACTCACCTGGCAGCCACTCCCAGAGCCCCTGGAACTCTGGCCCAAGGCTCTCTGACTGACTCCTTCCCAGATCTTCTCGGCTTAGCGGCTGAAGACTGACGCTGCCCGATCGCCTCGGAAGCCCCCTAGACCATCACGGACGCCGAGCTTTAGGTAACTCTCACAGTGGAGGGTAAGTCCGTCCCCTTCTTAATCAATACGGAGGCTACCCACTCCACATTACCTTCTTTTCAAGGGCCTGTTTCCCTTGCCTCCATAACTGTTGTGGGTATTGACGGCCAGGCTTCTAAACCTCTTAAAACTCCCCAACTCTGGTGCCAACTTAGACAATACTCTTTTAAGCACTCCTTTTTAGTTATCCCCACCTGCCCAGTTCCCTTATTAGGCCGAGACACTTTAACTAAATTATCTGCTTCCCTGACTATTCCTGGACTACAGCTACATCTCATTGCCGCCCTTCTTCCCAATCCAAAGCCTCCTTTGCGTCCTCCTCTTGTATCCCCCCACCTTAACCCACAAGTATAAGATACCTCTACTCCCTCCTTGGCGACCGATCATGCACCCCTTACCATCTCATTAAAACCTAATCACCCTTACCCCGCTCAATGCCAATATCCCATCCCACAGCATGCTTTAAAAGGATTAAAGCCTGTTATCACTCGCCTGCTACAGCATGGCCTTTTAAAGCCTATAAACTCTCCTTACAATTCCCCCATTTTACCTGTCCTAAAACCAGACAAGCCTTACAAGTTAGTTCAGGATCTGTGCCTTATCAACCAAATTGTTTTGCCTATCCACCCCATGGTGCCAAACCCATATACTCTCCTATCCTCAATACCTCCCTCCACAACCCATTATTCTGTTCTGGATCTCAAACATGCTTTCTTTACTATTCCTTTGCACCCTTCATCCCAGCCTCTCTTCGCTTTCACTTGGACTGACCCTGACACCCATCAGGCTCAGCAAATTACCTGGGCTGTACTGCCGCAAGGCTTCACAGACAGCCCCCATTACTTCAGTCAAGCCCAAATTTCTTCCTCATCTGTTACCTATCTCGGCATAATTCTCATAAAAACACACGTGCTCTCCCTGCTGATCGTGTCCGACTAATCTCTCAAACCCCAACCCCTTCTACAAAACAACAACTCCTTTCCTTCCTGGGCATGGTTAGATACTTTCGCCTTTGGATACCTGGTTTTGCCATCCTAACAAAACCATTATATAAACTCACAAAAGGAAACCTAGCTGACCCCATAGATCCTAAATCCTTTCCCCACTCCTCTTTCCATTCCTTGAAGACAGCTTTAGAGACTGCCCCCACCCTAGCTCTCCCTGACTCATCCCAACCCTTTTCATTACACACAGCCGAAGTGCAGGGCTGTGCAGTCGGAATTCTTACACAAGGACCGGGATCGCGTCCTGTAGCCTTTTTGTCCAAACAACTTGACCTTACTGTTTTAGGCTGGCCATCATGTCTCCGTGCAGCGGCTGCTGCTGCCCTAATACTTTTAGAGGCCCTCAAAATCACAAACTATGCTCAACTCACTCTCTACAGTTCTCATAACTTCCAAAATCTATTTTCTTCCTCACACCTGACGCATATACTTTCTGCTCCCCGGCTCCTTCAGCTGTACTCACTCTTTGTTGAGTCTCCCACAATTACCATTGTTCCTGGCCCNGACTTCAATCCGGCCTCCCACATTATTCCTGATACCACACCTGACCCCCATGACTGTATCTCTCTGATCCACCTGACATTCACCCCATTTCCCCATATTTCCTTCTTCCCTGTTCCTCACCCTGATCACACTTGGTTTATTGATGGCAGTTCCACCAGGCCTAATCGCCACACACCAGCAAAGGCAGGCTATGCTAT

#region extracted from blast conserved domain search:
#>HERVH_pol.fa
#CACCCTTACCCCGCTCAATGCCAATATCCCATCCCACAGCATGCTTTAAAAGGATTAAAGCCTGTTATCACTCGCCTGCTACAGCATGGCCTTTTAAAGCCTATAAACTCTCCTTACAATTCCCCCATTTTACCTGTCCTAAAACCAGACAAGCCTTACAAGTTAGTTCAGGATCTGTGCCTTATCAACCAAATTGTTTTGCCTATCCACCCCATGGTGCCAAACCCATATACTCTCCTATCCTCAATACCTCCCTCCACAACCCATTATTCTGTTCTGGATCTCAAACATGCTTTCTTTACTATTCCTTTGCACCCTTCATCCCAGCCTCTCTTCGCTTTCACTTGGA




#Add existing reg annotations full_length sequences:
#see phyloregulatory folder for '347_HERVH_LTR7_FOXP1_KLF4_MED1_NANOG_OCT4_SMAD11_SOX2_TCF4_FOXA1_7up_chimeric_7of7_done.bed' 
#HERVH_full is a bed file with all full length HERVH-LTR7 from OneCode (see OneCode folder)

cd /workdir/tc643/LTR_differential_activity/imbeault_XO/HERVH_full_clustering_txn_info/manu_TF/hg38/pol_alignment
intersectBed -wo -a ../347_HERVH_LTR7_FOXP1_KLF4_MED1_NANOG_OCT4_SMAD11_SOX2_TCF4_FOXA1_7up_chimeric_7of7_done.bed -b ../../../../../Final_figures/HERVH_full > HERVH_LTR7_full_70f7_info_intersect.bed

awk '{print $8 "\t" $9 "\t" $10 "\t" $4 "\t" "." "\t" $6}' HERVH_LTR7_full_70f7_info_intersect.bed > HERVH_LTR7_full_70f7_info.bed

/programs/bedtools2-2.29.2/bin/bedtools getfasta -s -name -fi /workdir/Genomes/homoSap/hg38/hg38.fa -bed HERVH_LTR7_full_70f7_info.bed > HERVH_LTR7_full_70f7_info.fa
grep -c ">" HERVH_LTR7_full_70f7_info.fa # 705, some lost from LTR list due to tree pruning

grep -c "SOLO" HERVH_LTR7_full_70f7_info.fa #0; no solos here. 

intersectBed -v -a <(grep -v "SOLO" ../347_HERVH_LTR7_FOXP1_KLF4_MED1_NANOG_OCT4_SMAD11_SOX2_TCF4_FOXA1_7up_chimeric_7of7_done.bed) -b ../../../../../Final_figures/HERVH_full | wc -l #0
#yes, these missing sequences are likely from pruning the tree




#Find matching sequences in HERVH/LTR7 fulls:

blat -out=axt HERVH_pol.fa HERVH_LTR7_full_70f7_info.fa HERVH_LTR7_full_polBLAT.tab

wc -l HERVH_LTR7_full_polBLAT.fa #626


#clean for mafft:
sed 's/^[0-9]*\s/>/g' HERVH_LTR7_full_polBLAT.tab > HERVH_LTR7_full_polBLAT.fa 
sed -i 's/:/_/g' HERVH_LTR7_full_polBLAT.fa
sed -i 's/)/_/g' HERVH_LTR7_full_polBLAT.fa
sed -i 's/(/_/g' HERVH_LTR7_full_polBLAT.fa
sed -i 's/;/_/g' HERVH_LTR7_full_polBLAT.fa
sed -i 's/,/_/g' HERVH_LTR7_full_polBLAT.fa
sed -i 's/\s/_/g' HERVH_LTR7_full_polBLAT.fa



/programs/mafft/bin/mafft --thread 100 --auto HERVH_subs_polBLAT_min250.fa > HERVH_subs_polBLAT_min250.mafft.fa
sed -i 's/:/_/g' HERVH_subs_polBLAT_min250.mafft.fa
sed -i 's/)/_/g' HERVH_subs_polBLAT_min250.mafft.fa
sed -i 's/(/_/g' HERVH_subs_polBLAT_min250.mafft.fa
sed -i 's/;/_/g' HERVH_subs_polBLAT_min250.mafft.fa
sed -i 's/,/_/g' HERVH_subs_polBLAT_min250.mafft.fa



/programs/iqtree-1.6.10-Linux/bin/iqtree -s HERVH_subs_polBLAT_min250.mafft.fa -nt AUTO -pre HERVH_subs_polBLAT_min250.mafft_trimal -m MFP -bb 1000 -asr -ntmax 100 -minsup .95


